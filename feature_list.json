{
  "meta": {
    "created": "2025-12-27",
    "spec_version": "1.0",
    "design_version": "2.0",
    "total_features": 40
  },
  "features": [
    {
      "id": "proj-setup",
      "category": "infrastructure",
      "priority": 1,
      "description": "Fix pyproject.toml: remove old deps (numpy, sentence-transformers, scikit-learn, tqdm), add claude-agent-sdk. Create src/chat_retro/__init__.py and __main__.py. Create tests/ directory structure.",
      "verification_steps": [
        "uv sync succeeds without errors",
        "src/chat_retro/__init__.py exists",
        "src/chat_retro/__main__.py exists with main() stub",
        "tests/ directory exists"
      ],
      "passes": true
    },
    {
      "id": "state-models",
      "category": "functional",
      "priority": 2,
      "description": "Pydantic models for AnalysisState, StateMeta, Pattern, UserPreferences, SnapshotRef with schema_version field.",
      "verification_steps": [
        "uv run python -c 'from chat_retro.state import AnalysisState' succeeds",
        "Models validate sample state.json structure from design doc"
      ],
      "passes": true
    },
    {
      "id": "state-manager",
      "category": "functional",
      "priority": 3,
      "description": "StateManager class with load(), save(), and merge_patterns() methods. Atomic save with tmp file rename. Corruption recovery with .corrupt backup.",
      "verification_steps": [
        "uv run pytest tests/test_state.py exits 0"
      ],
      "passes": true
    },
    {
      "id": "hook-audit-logger",
      "category": "functional",
      "priority": 4,
      "description": "audit_logger hook that logs tool usage without exposing content. Hash file paths, log tool names/timestamps/session IDs only.",
      "verification_steps": [
        "Hook function exists and is callable",
        "Returns expected output format per SDK spec"
      ],
      "passes": true
    },
    {
      "id": "hook-block-writes",
      "category": "functional",
      "priority": 5,
      "description": "block_external_writes hook that prevents writes outside ./outputs/, ./state.json, ./.chat-retro/",
      "verification_steps": [
        "Returns deny for paths outside allowed prefixes",
        "Returns empty dict for allowed paths"
      ],
      "passes": true
    },
    {
      "id": "hook-state-mutation",
      "category": "functional",
      "priority": 6,
      "description": "state_mutation_logger hook that tracks Edit operations on state.json for efficiency analysis.",
      "verification_steps": [
        "uv run pytest tests/test_hooks.py exits 0"
      ],
      "passes": true
    },
    {
      "id": "usage-report",
      "category": "functional",
      "priority": 7,
      "description": "UsageReport dataclass that tracks costs and tokens. update_from_result() method processes ResultMessage. summary() returns formatted string.",
      "verification_steps": [
        "uv run python -c 'from chat_retro.usage import UsageReport' succeeds",
        "UsageReport.summary() returns expected format"
      ],
      "passes": true
    },
    {
      "id": "session-manager-basic",
      "category": "functional",
      "priority": 8,
      "description": "SessionManager class wrapping ClaudeSDKClient. start_session() method that captures session_id from init message.",
      "verification_steps": [
        "uv run python -c 'from chat_retro.session import SessionManager' succeeds",
        "Code matches design doc section 3.1 patterns"
      ],
      "passes": true
    },
    {
      "id": "session-interaction-loop",
      "category": "functional",
      "priority": 9,
      "description": "run_interaction_loop() method with streaming response handling. User input loop with exit/quit support.",
      "verification_steps": [
        "Method exists with async generator handling",
        "Handles ResultMessage for cost tracking"
      ],
      "passes": true
    },
    {
      "id": "session-resumption",
      "category": "functional",
      "priority": 10,
      "description": "Session resumption via stored session_id. Pass to ClaudeAgentOptions(resume=session_id).",
      "verification_steps": [
        "start_session() accepts resume_id parameter",
        "Session ID persisted to .chat-retro/sessions/"
      ],
      "passes": true
    },
    {
      "id": "cli-argparse",
      "category": "functional",
      "priority": 11,
      "description": "CLI entry point with argparse: chat-retro <export_path> [--resume <session_id>]",
      "verification_steps": [
        "uv run python -m chat_retro --help exits 0",
        "Shows export_path and --resume arguments"
      ],
      "passes": true
    },
    {
      "id": "cli-wire-components",
      "category": "functional",
      "priority": 12,
      "description": "Wire together session manager + state manager in CLI. Graceful Ctrl+C interrupt handling.",
      "verification_steps": [
        "CLI loads state.json if exists",
        "Ctrl+C triggers graceful shutdown"
      ],
      "passes": true
    },
    {
      "id": "artifact-html-template",
      "category": "functional",
      "priority": 13,
      "description": "HTML template structure per ADR-003. Self-contained with inlined CSS/JS, DATA constant for embedded JSON.",
      "verification_steps": [
        "Template produces valid HTML",
        "No external network requests in output"
      ],
      "passes": true
    },
    {
      "id": "artifact-d3-bundling",
      "category": "functional",
      "priority": 14,
      "description": "D3.js minified bundle (~250KB) inlined in HTML output. Works from file:// protocol.",
      "verification_steps": [
        "D3.js source included in artifacts.py or bundled file",
        "Generated HTML works when opened as local file"
      ],
      "passes": true
    },
    {
      "id": "artifact-generator-class",
      "category": "functional",
      "priority": 15,
      "description": "ArtifactGenerator class with generate_html() and generate_markdown() methods.",
      "verification_steps": [
        "uv run pytest tests/test_artifacts.py exits 0"
      ],
      "passes": true
    },
    {
      "id": "system-prompt",
      "category": "functional",
      "priority": 16,
      "description": "System prompt from design doc section 4.1. Agent persona as chat retrospective analyst. Tool usage instructions. Analysis approach guidance.",
      "verification_steps": [
        "Prompt exists in prompts.py",
        "Covers role, tools, approach, constraints"
      ],
      "passes": true
    },
    {
      "id": "error-handling",
      "category": "functional",
      "priority": 17,
      "description": "User-friendly error messages for CLINotFoundError, ProcessError, FileNotFoundError per design doc section 4.5.",
      "verification_steps": [
        "USER_ERRORS dict exists with friendly messages",
        "RateLimiter class implemented"
      ],
      "passes": true
    },
    {
      "id": "runtime-dirs",
      "category": "functional",
      "priority": 18,
      "description": "Create runtime directories on first run: .chat-retro/, .chat-retro/sessions/, outputs/",
      "verification_steps": [
        "Directories created if missing",
        "No errors on repeated runs"
      ],
      "passes": true
    },
    {
      "id": "integration-test",
      "category": "polish",
      "priority": 19,
      "description": "End-to-end test with sample export. Verify session works, state saves, artifact generates.",
      "verification_steps": [
        "Run with sample ChatGPT export",
        "state.json created with patterns",
        "HTML artifact renders in browser"
      ],
      "passes": true
    },
    {
      "id": "claude-export-format",
      "category": "polish",
      "priority": 20,
      "description": "Support Claude export format in addition to ChatGPT. Agent detects format and adapts.",
      "verification_steps": [
        "Run with sample Claude export",
        "Agent correctly identifies format"
      ],
      "passes": true
    },
    {
      "id": "viz-timeline",
      "category": "visualization",
      "priority": 21,
      "description": "D3.js timeline visualization showing conversation frequency over time (line/area chart).",
      "verification_steps": [
        "HTML artifact renders in browser",
        "Shows time axis with correct date labels",
        "Data points correspond to conversation dates"
      ],
      "passes": true
    },
    {
      "id": "viz-heatmap",
      "category": "visualization",
      "priority": 22,
      "description": "D3.js heatmap showing usage patterns by hour and weekday (7x24 grid).",
      "verification_steps": [
        "Shows 7x24 grid with intensity coloring",
        "Weekday and hour labels visible",
        "Intensity corresponds to conversation frequency"
      ],
      "passes": true
    },
    {
      "id": "viz-topic-clusters",
      "category": "visualization",
      "priority": 23,
      "description": "D3.js force-directed graph showing topic clusters and relationships.",
      "verification_steps": [
        "Nodes are draggable",
        "Clusters visually distinct",
        "Links show topic relationships"
      ],
      "passes": true
    },
    {
      "id": "viz-length-distribution",
      "category": "visualization",
      "priority": 24,
      "description": "D3.js histogram showing distribution of conversation lengths.",
      "verification_steps": [
        "Bar chart with appropriate bins",
        "Axis labels show message counts",
        "Bins correspond to length ranges"
      ],
      "passes": true
    },
    {
      "id": "agent-topic-extractor",
      "category": "subagent",
      "priority": 25,
      "description": "Specialized subagent that extracts and clusters topics from conversations.",
      "verification_steps": [
        "AgentDefinition configured in agents.py",
        "Returns structured topic list with confidence scores",
        "Integrates with main session via Task tool"
      ],
      "passes": true
    },
    {
      "id": "agent-sentiment-tracker",
      "category": "subagent",
      "priority": 26,
      "description": "Specialized subagent that tracks emotional tone evolution across conversations.",
      "verification_steps": [
        "AgentDefinition configured in agents.py",
        "Returns sentiment timeline data",
        "Identifies emotional peaks and valleys"
      ],
      "passes": true
    },
    {
      "id": "agent-pattern-detector",
      "category": "subagent",
      "priority": 27,
      "description": "Specialized subagent that identifies prompting patterns and anti-patterns.",
      "verification_steps": [
        "AgentDefinition configured in agents.py",
        "Returns pattern observations with examples",
        "Flags potential anti-patterns"
      ],
      "passes": true
    },
    {
      "id": "agent-temporal-analyst",
      "category": "subagent",
      "priority": 28,
      "description": "Specialized subagent that analyzes time-based usage patterns.",
      "verification_steps": [
        "AgentDefinition configured in agents.py",
        "Returns temporal insights (peak times, trends)",
        "Correlates time with topics"
      ],
      "passes": true
    },
    {
      "id": "insight-prompt-improvements",
      "category": "insights",
      "priority": 29,
      "description": "Generate concrete suggestions for better prompting based on conversation analysis.",
      "verification_steps": [
        "Markdown output with before/after examples",
        "Suggestions are specific and actionable",
        "Based on actual conversation patterns"
      ],
      "passes": true
    },
    {
      "id": "insight-repetition-detection",
      "category": "insights",
      "priority": 30,
      "description": "Identify repetitive queries that could be templated or systematized.",
      "verification_steps": [
        "Returns list of repeated patterns",
        "Groups similar queries together",
        "Suggests templates for common patterns"
      ],
      "passes": true
    },
    {
      "id": "insight-usage-optimization",
      "category": "insights",
      "priority": 31,
      "description": "Generate time and context recommendations for optimal AI usage.",
      "verification_steps": [
        "Actionable bullet points",
        "Based on temporal and success patterns",
        "Specific to user's usage data"
      ],
      "passes": true
    },
    {
      "id": "interact-filter-panel",
      "category": "interactive",
      "priority": 32,
      "description": "Interactive filter panel in HTML artifacts for date range, topic, and sentiment filtering.",
      "verification_steps": [
        "Filter controls render in browser",
        "Filters update visualization in real-time",
        "Multiple filters can be combined"
      ],
      "passes": true
    },
    {
      "id": "interact-search",
      "category": "interactive",
      "priority": 33,
      "description": "Full-text search capability within HTML artifacts.",
      "verification_steps": [
        "Search box accepts input",
        "Results highlight matching patterns",
        "Search is performant on large datasets"
      ],
      "passes": true
    },
    {
      "id": "interact-detail-view",
      "category": "interactive",
      "priority": 34,
      "description": "Click pattern to see example conversations in modal or expandable detail view.",
      "verification_steps": [
        "Clicking pattern shows details",
        "Modal or expansion works smoothly",
        "Example conversations are readable"
      ],
      "passes": true
    },
    {
      "id": "interact-annotations",
      "category": "interactive",
      "priority": 35,
      "description": "User can add notes and annotations to patterns, persisted in localStorage.",
      "verification_steps": [
        "Annotation UI available on patterns",
        "Notes persist across page reloads",
        "Annotations visible in artifact"
      ],
      "passes": true
    },
    {
      "id": "eval-quality-prompts",
      "category": "eval",
      "priority": 36,
      "description": "After analysis, CLI asks targeted quality questions about insights and patterns.",
      "verification_steps": [
        "Quality prompts appear after analysis",
        "User responses are captured",
        "Questions are specific to generated output"
      ],
      "passes": true
    },
    {
      "id": "eval-rating-system",
      "category": "eval",
      "priority": 37,
      "description": "Rate patterns and insights with 1-5 scale or thumbs up/down.",
      "verification_steps": [
        "Rating UI available for patterns",
        "Ratings persisted to state.json feedback section",
        "Aggregate ratings accessible"
      ],
      "passes": true
    },
    {
      "id": "eval-gap-detection",
      "category": "eval",
      "priority": 38,
      "description": "User can flag 'I expected X but didn't see it' to identify missing features.",
      "verification_steps": [
        "Gap reporting mechanism available",
        "Gaps logged for future improvement",
        "Gap categories are structured"
      ],
      "passes": true
    },
    {
      "id": "eval-feedback-aggregation",
      "category": "eval",
      "priority": 39,
      "description": "Aggregate feedback across sessions for meta-analysis of tool effectiveness.",
      "verification_steps": [
        "Summary report generation available",
        "Trends visible across sessions",
        "Identifies consistently low-rated features"
      ],
      "passes": true
    },
    {
      "id": "eval-issue-reporter",
      "category": "eval",
      "priority": 40,
      "description": "Quick path to report bugs or issues directly from CLI.",
      "verification_steps": [
        "Issue reporting command available",
        "Opens GitHub issue template or logs locally",
        "Captures relevant context automatically"
      ],
      "passes": true
    }
  ]
}
